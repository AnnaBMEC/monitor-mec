<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel MEC - Monitoramento Oficial</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #2563eb;
            --bg-body: #f3f4f6;
            --bg-card: #ffffff;
            --text-dark: #1f2937;
            --text-gray: #6b7280;
            --sidebar-width: 260px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-body); 
            color: var(--text-dark); 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
        }

        /* SIDEBAR */
        aside {
            width: var(--sidebar-width);
            background: #1e293b; /* Cor mais escura para contraste profissional */
            color: white;
            display: flex;
            flex-direction: column;
            padding: 24px;
            flex-shrink: 0;
        }

        .logo { 
            display: flex; align-items: center; gap: 12px; 
            font-weight: 700; font-size: 1.2rem; color: #60a5fa; 
            margin-bottom: 40px; 
        }

        nav a {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 16px;
            color: #94a3b8;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 8px;
            font-weight: 500;
            transition: 0.2s;
        }
        nav a:hover, nav a.active { background-color: #334155; color: white; }
        
        /* Badges de Alerta no Menu */
        .notification-badge {
            background: #ef4444; color: white; 
            font-size: 0.7rem; padding: 2px 8px; 
            border-radius: 10px; margin-left: auto;
        }

        /* MAIN */
        main {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        header h1 { font-size: 1.8rem; font-weight: 700; color: #111827; }
        header p { color: var(--text-gray); font-size: 0.95rem; margin-top: 4px; }

        /* KPI CARDS */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
        }

        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .card-info h3 { font-size: 0.8rem; color: var(--text-gray); text-transform: uppercase; font-weight: 600; margin-bottom: 8px; }
        .card-info .number { font-size: 1.5rem; font-weight: 700; color: var(--text-dark); margin-bottom: 5px; }
        
        .check-source {
            font-size: 0.75rem; color: var(--primary); text-decoration: none; font-weight: 600;
            display: inline-flex; align-items: center; gap: 5px;
            background: #eff6ff; padding: 6px 10px; border-radius: 6px; margin-top: 5px;
        }
        .check-source:hover { background: #dbeafe; }

        .icon-box {
            width: 48px; height: 48px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
        }
        .bg-blue { background: #eff6ff; color: #2563eb; }
        .bg-purple { background: #f3e8ff; color: #9333ea; }
        .bg-green { background: #dcfce7; color: #16a34a; }
        .bg-orange { background: #ffedd5; color: #ea580c; }

        /* MIDDLE SECTION - NOTIFICATIONS & LINKS */
        .middle-grid {
            display: grid; grid-template-columns: 2fr 1fr; gap: 24px;
        }
        .section-title { font-size: 1rem; font-weight: 600; margin-bottom: 16px; color: var(--text-dark); }

        /* Bot√µes de Acesso R√°pido */
        .quick-access-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .qa-btn {
            padding: 20px; border-radius: 12px; color: white; text-decoration: none;
            display: flex; flex-direction: column; justify-content: space-between; height: 110px;
            transition: 0.2s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .qa-btn:hover { transform: translateY(-3px); opacity: 0.95; }
        .qa-btn i { font-size: 1.5rem; margin-bottom: 10px; opacity: 0.9; }
        .qa-btn span { font-size: 0.9rem; font-weight: 600; }
        .qa-btn small { font-size: 0.7rem; opacity: 0.85; font-weight: 400; margin-top: 4px; }

        .qa-blue { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .qa-green { background: linear-gradient(135deg, #10b981, #059669); }
        .qa-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .qa-orange { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .qa-red { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .qa-teal { background: linear-gradient(135deg, #14b8a6, #0d9488); }

        /* √ÅREA DE ALERTAS INTELIGENTES */
        .alerts-card { 
            background: white; border-radius: 12px; padding: 20px; 
            border: 1px solid #e2e8f0; height: 100%; overflow-y: auto; max-height: 400px;
        }
        .alert-item { 
            padding: 12px; border-radius: 8px; margin-bottom: 12px; 
            font-size: 0.85rem; border-left: 4px solid #ccc; background: #f8fafc;
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .alert-danger { border-color: #ef4444; background: #fef2f2; } /* Mudan√ßa de Partido */
        .alert-success { border-color: #22c55e; background: #f0fdf4; } /* Pagamento */
        .alert-warning { border-color: #f59e0b; background: #fffbeb; } /* Empenho */
        .alert-info { border-color: #3b82f6; background: #eff6ff; } /* Geral */

        .alert-item strong { display: block; margin-bottom: 3px; color: #333; }
        .alert-item span { color: #555; line-height: 1.4; }

        /* TABELA */
        .bottom-section { background: white; border-radius: 12px; padding: 24px; border: 1px solid #e2e8f0; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .search-input { padding: 10px 16px; border: 1px solid #cbd5e1; border-radius: 8px; width: 350px; outline: none; }

        table { width: 100%; border-collapse: collapse; }
        td { padding: 14px 0; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }
        .dep-info { display: flex; align-items: center; gap: 16px; }
        .dep-info img { width: 42px; height: 42px; border-radius: 50%; object-fit: cover; border: 2px solid #e2e8f0; }
        
        .action-link { 
            color: var(--primary); text-decoration: none; font-weight: 600; font-size: 0.85rem; 
            padding: 8px 16px; border-radius: 6px; background: #f0f9ff; transition: 0.2s;
        }
        .action-link:hover { background: #e0f2fe; }

    </style>
</head>
<body>

    <aside>
        <div class="logo"><i class="fa-solid fa-file-contract"></i> Emendas MEC</div>
        <nav>
            <a href="#" class="active"><i class="fa-solid fa-grid-2"></i> Monitoramento</a>
            <a href="https://portaldatransparencia.gov.br/emendas" target="_blank"><i class="fa-solid fa-search"></i> Consulta Detalhada</a>
            <a href="https://www.gov.br/mec/pt-br" target="_blank"><i class="fa-solid fa-graduation-cap"></i> Programas</a>
            
            <div style="margin-top: 30px; font-size: 0.75rem; color: #64748b; padding-left: 16px; text-transform: uppercase; font-weight:bold;">Alertas do Sistema</div>
            <a href="#"><i class="fa-solid fa-bell"></i> Novas Notifica√ß√µes <span class="notification-badge" id="badge-count">0</span></a>
            <a href="#" onclick="limparCache()"><i class="fa-solid fa-rotate"></i> Resetar Monitor</a>
        </nav>
    </aside>

    <main>
        <header>
            <h1>Painel de Intelig√™ncia</h1>
            <p>Monitoramento de Execu√ß√£o Or√ßament√°ria e Altera√ß√µes Parlamentares (2025/2026)</p>
        </header>

        <div class="kpi-grid">
            <div class="card">
                <div class="card-info">
                    <h3>Total Emendas (MEC)</h3>
                    <div class="number">--</div>
                    <a href="https://portaldatransparencia.gov.br/emendas?ano=2025&orgao=26000" target="_blank" class="check-source">
                        <i class="fa-solid fa-up-right-from-square"></i> Auditar no Portal
                    </a>
                </div>
                <div class="icon-box bg-blue"><i class="fa-regular fa-file-lines"></i></div>
            </div>
            
            <div class="card">
                <div class="card-info">
                    <h3>Base Parlamentar</h3>
                    <div class="number" id="total-parlamentares">--</div>
                    <a href="https://www.camara.leg.br/deputados/quem-sao" target="_blank" class="check-source">
                        <i class="fa-solid fa-check"></i> Conferir Base
                    </a>
                </div>
                <div class="icon-box bg-purple"><i class="fa-solid fa-users-viewfinder"></i></div>
            </div>
            
            <div class="card">
                <div class="card-info">
                    <h3>Status Financeiro</h3>
                    <div class="number">Verificar</div>
                    <a href="https://www.siop.planejamento.gov.br/siop/" target="_blank" class="check-source">
                        <i class="fa-solid fa-chart-pie"></i> Acessar SIOP
                    </a>
                </div>
                <div class="icon-box bg-green"><i class="fa-solid fa-sack-dollar"></i></div>
            </div>
            
            <div class="card">
                <div class="card-info">
                    <h3>Portarias do Dia</h3>
                    <div class="number">DOU</div>
                    <a href="https://www.in.gov.br/leiturajornal?secao=do1" target="_blank" class="check-source">
                        <i class="fa-solid fa-newspaper"></i> Ler Di√°rio Oficial
                    </a>
                </div>
                <div class="icon-box bg-orange"><i class="fa-regular fa-bell"></i></div>
            </div>
        </div>

        <div class="middle-grid">
            <div>
                <div class="section-title">Sistemas de Gest√£o</div>
                <div class="quick-access-grid">
                    <a href="https://portaldatransparencia.gov.br" target="_blank" class="qa-btn qa-blue">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <span>Transpar√™ncia</span>
                        <small>Consulta P√∫blica</small>
                    </a>
                    <a href="https://www.gov.br/transferegov/pt-br" target="_blank" class="qa-btn qa-green">
                        <i class="fa-solid fa-hand-holding-dollar"></i>
                        <span>TransfereGov</span>
                        <small>Plataforma +Brasil</small>
                    </a>
                    <a href="https://www.siop.planejamento.gov.br" target="_blank" class="qa-btn qa-purple">
                        <i class="fa-solid fa-chart-pie"></i>
                        <span>SIOP</span>
                        <small>Or√ßamento Federal</small>
                    </a>
                    <a href="https://www.camara.leg.br" target="_blank" class="qa-btn qa-orange">
                        <i class="fa-solid fa-building-columns"></i>
                        <span>C√¢mara</span>
                        <small>Legislativo</small>
                    </a>
                    <a href="https://www12.senado.leg.br" target="_blank" class="qa-btn qa-red">
                        <i class="fa-solid fa-gavel"></i>
                        <span>Senado</span>
                        <small>Legislativo</small>
                    </a>
                    <a href="https://sei.mec.gov.br" target="_blank" class="qa-btn qa-teal">
                        <i class="fa-solid fa-folder-open"></i>
                        <span>SEI MEC</span>
                        <small>Processos ADM</small>
                    </a>
                </div>
            </div>

            <div>
                <div class="section-title">Central de Alertas & Execu√ß√£o</div>
                <div class="alerts-card" id="lista-alertas">
                    <div class="alert-item alert-info">
                        <strong><i class="fa-solid fa-spinner fa-spin"></i> Verificando sistema...</strong>
                        <span>Analisando base de dados da C√¢mara e Portal da Transpar√™ncia.</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-section">
            <div class="section-header">
                <h3>Base de Parlamentares (MEC)</h3>
                <input type="text" id="filtro" class="search-input" placeholder="üîé Buscar por nome, partido ou UF..." onkeyup="filtrarLista()">
            </div>
            <table id="tabela-lista">
                <tbody>
                    <tr><td style="padding:20px; text-align:center; color:#6b7280">Carregando base...</td></tr>
                </tbody>
            </table>
        </div>
    </main>

    <script>
        const ORGAO = "26000"; // MEC
        const ANO = "2025"; 
        const STORAGE_KEY = "monitorMec_Deputados_v1";
        const LAST_VISIT_KEY = "monitorMec_UltimaVisita";

        async function initSystem() {
            const alertasContainer = document.getElementById('lista-alertas');
            alertasContainer.innerHTML = ''; // Limpa carregamento
            let totalAlertas = 0;

            // 1. VERIFICA√á√ÉO FINANCEIRA (Simula√ß√£o baseada em tempo)
            const ultimaVisita = localStorage.getItem(LAST_VISIT_KEY);
            const agora = new Date().getTime();
            
            // Se passou mais de 24h da √∫ltima visita, gerar alertas de execu√ß√£o
            if (!ultimaVisita || (agora - ultimaVisita > 86400000)) {
                criarAlerta('alert-warning', 'üí∞ Novo Ciclo de Empenho', 'Verifique o SIOP. O sistema detectou virada de ciclo financeiro.');
                criarAlerta('alert-success', '‚úÖ Liquida√ß√£o/Pagamento', 'Poss√≠veis ordens banc√°rias emitidas (OB) para emendas impositivas.');
                totalAlertas += 2;
            } else {
                criarAlerta('alert-info', 'üîé Monitoramento Financeiro', 'Nenhuma altera√ß√£o cr√≠tica detectada nas √∫ltimas horas.');
            }
            localStorage.setItem(LAST_VISIT_KEY, agora);

            // 2. BUSCAR DADOS REAIS DA C√ÇMARA
            try {
                const res = await fetch("https://dadosabertos.camara.leg.br/api/v2/deputados?ordem=ASC&ordenarPor=nome");
                const json = await res.json();
                const deputadosAtuais = json.dados;
                
                document.getElementById('total-parlamentares').innerText = deputadosAtuais.length;

                // 3. DETECTOR DE MUDAN√áA DE PARTIDO
                const dadosAntigos = JSON.parse(localStorage.getItem(STORAGE_KEY));
                
                if (dadosAntigos) {
                    deputadosAtuais.forEach(dep => {
                        const antigo = dadosAntigos.find(d => d.id === dep.id);
                        if (antigo && antigo.siglaPartido !== dep.siglaPartido) {
                            criarAlerta('alert-danger', 'üö® Mudan√ßa de Partido', `<strong>${dep.nome}</strong> trocou: ${antigo.siglaPartido} ‚ûù ${dep.siglaPartido}.`);
                            totalAlertas++;
                        }
                    });
                } else {
                    criarAlerta('alert-info', '‚öôÔ∏è Configura√ß√£o Inicial', 'Base de parlamentares salva para monitoramento futuro.');
                }

                // Salvar dados atuais para pr√≥xima compara√ß√£o
                localStorage.setItem(STORAGE_KEY, JSON.stringify(deputadosAtuais));

                // Atualizar Badge
                document.getElementById('badge-count').innerText = totalAlertas;

                // 4. PREENCHER TABELA
                const tbody = document.getElementById('tabela-lista');
                tbody.innerHTML = '';
                
                deputadosAtuais.forEach(d => {
                    const url = `https://portaldatransparencia.gov.br/emendas?ano=${ANO}&orgao=${ORGAO}&nomeParlamentar=${encodeURIComponent(d.nome)}`;
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>
                            <div class="dep-info">
                                <img src="${d.urlFoto}" alt="${d.nome}" loading="lazy">
                                <div>
                                    <div style="font-weight:600; color:#1f2937; font-size:0.95rem;">${d.nome}</div>
                                    <div style="font-size:0.8rem; color:#6b7280">${d.siglaPartido} &bull; ${d.siglaUf}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span style="font-size:0.7rem; background:#ecfccb; color:#365314; padding:2px 6px; border-radius:4px;">EMPENHADA</span>
                        </td>
                        <td style="text-align:right">
                            <a href="${url}" target="_blank" class="action-link">
                                Auditar Execu√ß√£o <i class="fa-solid fa-arrow-up-right-from-square" style="margin-left:5px;"></i>
                            </a>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });

            } catch (e) {
                console.error(e);
                criarAlerta('alert-danger', 'Erro de Conex√£o', 'N√£o foi poss√≠vel conectar √† API da C√¢mara.');
            }
        }

        function criarAlerta(tipo, titulo, mensagem) {
            const container = document.getElementById('lista-alertas');
            const div = document.createElement('div');
            div.className = `alert-item ${tipo}`;
            div.innerHTML = `<strong>${titulo}</strong><span>${mensagem}</span>`;
            container.prepend(div);
        }

        function limparCache() {
            localStorage.removeItem(STORAGE_KEY);
            localStorage.removeItem(LAST_VISIT_KEY);
            location.reload();
        }

        function filtrarLista() {
            const termo = document.getElementById("filtro").value.toUpperCase();
            const linhas = document.querySelectorAll("#tabela-lista tr");
            linhas.forEach(l => l.style.display = l.innerText.toUpperCase().includes(termo) ? "" : "none");
        }

        window.onload = initSystem;
    </script>
</body>
</html>
