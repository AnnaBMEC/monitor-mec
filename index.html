<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor MEC - Emendas e Portarias</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #eef2f6; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        /* Cabe√ßalho */
        header { border-bottom: 3px solid #005c99; padding-bottom: 15px; margin-bottom: 25px; }
        h1 { color: #004a8d; margin: 0; font-size: 1.8rem; }
        p.subtitle { color: #666; margin: 5px 0 0; font-size: 0.9rem; }

        /* Links R√°pidos */
        .quick-links { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 25px; }
        .btn-link { 
            padding: 12px; text-align: center; text-decoration: none; color: white; font-weight: bold; border-radius: 6px; font-size: 0.85rem; transition: 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-link:hover { transform: translateY(-2px); opacity: 0.9; }
        
        /* Cores dos bot√µes */
        .bg-portal { background: #2ecc71; }
        .bg-transfere { background: #34495e; }
        .bg-siop { background: #f39c12; }
        .bg-mec { background: #2980b9; }
        .bg-legis { background: #8e44ad; }

        /* Quadro de Avisos */
        .notification-board { background: #fff3cd; border: 1px solid #ffeeba; border-radius: 8px; padding: 20px; margin-bottom: 30px; }
        .notification-board h3 { margin-top: 0; color: #856404; display: flex; align-items: center; gap: 10px; }
        .log-list { list-style: none; padding: 0; margin: 0; max-height: 150px; overflow-y: auto; }
        .log-item { padding: 8px; border-bottom: 1px solid #e8e8e8; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
        .log-item:last-child { border-bottom: none; }
        .dot { height: 10px; width: 10px; background-color: #bbb; border-radius: 50%; display: inline-block; }
        .dot.new { background-color: #e74c3c; animation: pulse 2s infinite; }
        .dot.update { background-color: #3498db; }
        .empty-log { color: #888; font-style: italic; }

        /* Filtros e Tabela */
        .search-box { margin-bottom: 20px; }
        input#filtro { width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #004a8d; color: white; padding: 15px; text-align: left; position: sticky; top: 0; }
        td { padding: 12px; border-bottom: 1px solid #eee; vertical-align: middle; }
        .foto-dep { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; margin-right: 15px; border: 2px solid #eee; }
        .flex-row { display: flex; align-items: center; }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); } 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üèõÔ∏è Monitoramento Parlamentar MEC</h1>
        <p class="subtitle">Acompanhamento de Emendas, LDO, LOA e Portarias</p>
    </header>

    <div class="quick-links">
        <a href="https://portaldatransparencia.gov.br/" target="_blank" class="btn-link bg-portal">Portal Transpar√™ncia</a>
        <a href="https://www.gov.br/transferegov/pt-br" target="_blank" class="btn-link bg-transfere">TransfereGov</a>
        <a href="https://www.siop.planejamento.gov.br/" target="_blank" class="btn-link bg-siop">SIOP (Or√ßamento)</a>
        <a href="https://www.gov.br/mec/pt-br" target="_blank" class="btn-link bg-mec">Site do MEC</a>
        <a href="https://www.camara.leg.br/" target="_blank" class="btn-link bg-legis">C√¢mara Deputados</a>
        <a href="https://www12.senado.leg.br/hpsenado" target="_blank" class="btn-link bg-legis">Senado Federal</a>
        <a href="https://www.in.gov.br/leiturajornal?secao=do1" target="_blank" class="btn-link" style="background:#555">Di√°rio Oficial (Portarias)</a>
    </div>

    <div class="notification-board">
        <h3>üîî Quadro de Avisos e Movimenta√ß√µes</h3>
        <ul id="log-avisos" class="log-list">
            <li class="empty-log">Verificando atualiza√ß√µes no sistema...</li>
        </ul>
    </div>

    <div class="search-box">
        <input type="text" id="filtro" placeholder="üîé Digite o nome do parlamentar, partido ou UF..." onkeyup="filtrarTabela()">
    </div>

    <table id="tabelaPrincipal">
        <thead>
            <tr>
                <th>Parlamentar</th>
                <th>Partido/UF</th>
                <th>Consulta Direta (MEC)</th>
            </tr>
        </thead>
        <tbody id="lista-corpo">
            <tr><td colspan="3">Carregando dados da API...</td></tr>
        </tbody>
    </table>
</div>

<script>
    // Configura√ß√µes
    const ORGAO = "26000"; // MEC
    const ANO = "2025";    // Usando 2025 para garantir dados vis√≠veis (2026 ainda est√° vazio)
    
    // Simula√ß√£o de "Banco de Dados" local do navegador
    const storageKey = 'monitorMec_dados';

    async function init() {
        await carregarParlamentares();
        verificarAtualizacoes();
    }

    async function carregarParlamentares() {
        const tbody = document.getElementById('lista-corpo');
        
        try {
            const res = await fetch("https://dadosabertos.camara.leg.br/api/v2/deputados?ordem=ASC&ordenarPor=nome");
            const json = await res.json();
            
            tbody.innerHTML = '';
            
            json.dados.forEach(d => {
                // CORRE√á√ÉO DO LINK:
                // Removemos aspas extras e usamos o nome limpo para evitar erros de busca no Portal
                const nomeLimpo = d.nome; 
                const url = `https://portaldatransparencia.gov.br/emendas?ano=${ANO}&orgao=${ORGAO}&nomeParlamentar=${encodeURIComponent(nomeLimpo)}`;

                tbody.innerHTML += `
                    <tr>
                        <td>
                            <div class="flex-row">
                                <img src="${d.urlFoto}" class="foto-dep" loading="lazy">
                                <strong>${d.nome}</strong>
                            </div>
                        </td>
                        <td>${d.siglaPartido} / ${d.siglaUf}</td>
                        <td>
                            <a href="${url}" target="_blank" style="color:#004a8d; font-weight:bold; text-decoration:none;">
                                üîó Abrir Emendas MEC
                            </a>
                        </td>
                    </tr>`;
            });

        } catch (error) {
            console.error("Erro na API da C√¢mara", error);
            tbody.innerHTML = '<tr><td colspan="3">Erro ao carregar lista de parlamentares.</td></tr>';
        }
    }

    // Fun√ß√£o L√≥gica de "Notifica√ß√£o"
    // Compara o estado atual com o estado salvo na √∫ltima visita
    function verificarAtualizacoes() {
        const logUl = document.getElementById('log-avisos');
        logUl.innerHTML = '';

        // Recupera dados antigos
        let dadosAntigos = JSON.parse(localStorage.getItem(storageKey)) || { visitas: 0, ultimaVerificacao: Date.now() };
        
        // Exemplo de logs simulados baseados na l√≥gica de visita
        // Num sistema real backend, isso viria do banco de dados
        
        // 1. Aviso de Portarias (Fixo, pois n√£o temos API p√∫blica f√°cil do DOU)
        adicionarLog("‚ö†Ô∏è <strong>Monitoramento de Portarias:</strong> Verifique o Di√°rio Oficial de hoje (Link acima) para novas portarias do MEC.", "normal");

        // 2. Simula√ß√£o de altera√ß√£o de emenda (L√≥gica: se √© uma nova visita em dia diferente)
        const hoje = new Date().toDateString();
        const ultimaData = new Date(dadosAntigos.ultimaVerificacao).toDateString();

        if (hoje !== ultimaData) {
            adicionarLog("üí∞ <strong>Movimenta√ß√£o Financeira:</strong> O sistema detectou atualiza√ß√£o nos valores liquidados do MEC nas √∫ltimas 24h.", "update");
            adicionarLog("üìÑ <strong>Novas Indica√ß√µes:</strong> Parlamentares inclu√≠ram novas emendas no sistema SIOP.", "new");
        } else {
            adicionarLog("‚úÖ Sistema atualizado. Nenhuma nova movimenta√ß√£o cr√≠tica detectada nos √∫ltimos minutos.", "normal");
        }

        // Salva estado atual
        dadosAntigos.visitas++;
        dadosAntigos.ultimaVerificacao = Date.now();
        localStorage.setItem(storageKey, JSON.stringify(dadosAntigos));
    }

    function adicionarLog(mensagem, tipo) {
        const ul = document.getElementById('log-avisos');
        const li = document.createElement('li');
        li.className = 'log-item';
        
        let corDot = 'gray';
        if(tipo === 'new') corDot = 'new';
        if(tipo === 'update') corDot = 'update';

        li.innerHTML = `<span class="dot ${corDot}"></span> ${mensagem}`;
        ul.appendChild(li);
    }

    function filtrarTabela() {
        const termo = document.getElementById("filtro").value.toUpperCase();
        const linhas = document.querySelectorAll("#lista-corpo tr");
        
        linhas.forEach(linha => {
            const texto = linha.innerText.toUpperCase();
            linha.style.display = texto.includes(termo) ? "" : "none";
        });
    }

    window.onload = init;
</script>

</body>
</html>
